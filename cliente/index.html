<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Strike Command: Dominio Total</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="./cliente/css/game-styles.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js" integrity="sha512-3j3VU6WC5rPQB4Ld1jnLV7Kd5xr+cq9avvhwqzbH/taCRNURoeEpoPBK9pDyeukwSxwRPJ8fDgvYXd6SkaZ2TA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        /* Estilos adicionales para z-index */
        .modal { z-index: 5000 !important; }
        .modal-backdrop { z-index: 4500 !important; }
        /* Google One Tap styling - posici√≥n mejorada */
        .google-signin-container {
            position: fixed;
            top: 15px;
            right: 20px;
            z-index: 1000;
            background: rgba(13, 27, 42, 0.95);
            padding: 12px 15px;
            border-radius: 12px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }
        .google-signin-container::before {
            content: 'üéñÔ∏è Iniciar sesi√≥n';
            display: block;
            color: #FFD700;
            font-weight: 700;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            text-align: center;
        }
    </style>

    <script src="./cliente/clienteRest.js"></script>
    <script src="./cliente/controlWeb.js"></script>
    <script src="./cliente/clienteWS.js"></script>

</head>
<body class="game-body">
    <!-- Google One Tap -->
    <div id="googleSigninContainer" class="google-signin-container">
        <div id="g_id_onload"
            data-client_id="270733010519-a35099usqc22lr9400m7m7pp3ngheseb.apps.googleusercontent.com"
            data-login_uri="/oneTap/callback"
            data-skip_prompt_cookie="nick"
        ></div>
        <div class="g_id_signin" data-type="standard" data-shape="rectangular" data-theme="outline" data-text="signin_with" data-size="large" data-logo_alignment="left"></div>
    </div>

    <!-- Panel de Clasificaci√≥n (se muestra cuando est√° logueado) -->
    <div id="rankingPanel" class="ranking-panel-container" style="display: none;">
        <div class="ranking-toggle" id="rankingToggleBtn">
            <span class="ranking-toggle-icon">üèÜ</span>
            <span class="ranking-toggle-text">Ligas</span>
        </div>
        <div class="ranking-dropdown" id="rankingDropdown">
            <div class="ranking-header">
                <h4>üìä Clasificaci√≥n de Ligas</h4>
            </div>
            <div class="ranking-list" id="rankingList">
                <!-- Se llena din√°micamente -->
            </div>
        </div>
    </div>

    <!-- Icono de Perfil (se muestra cuando est√° logueado) -->
    <div id="profileIcon" class="profile-icon-container" style="display: none;">
        <div class="profile-icon" id="profileIconBtn">
            <span id="profileInitial">?</span>
        </div>
        <!-- Dropdown del perfil -->
        <div class="profile-dropdown" id="profileDropdown">
            <div class="profile-header-new">
                <div class="profile-avatar-large" id="profileAvatarLarge">?</div>
                <div class="profile-info-new">
                    <div class="profile-name-row">
                        <span class="profile-name" id="profileName">Comandante</span>
                        <div class="profile-rank-badge" id="profileRankBadge">
                            <span class="rank-shield" id="rankShield">‚öîÔ∏è</span>
                            <span class="rank-name-small" id="rankNameSmall">Recluta I</span>
                        </div>
                    </div>
                    <div class="profile-trophies">
                        <span id="profileTrophies">0</span> üèÜ Copas
                    </div>
                </div>
            </div>
            
            <div class="profile-section-title">üìä Estad√≠sticas de Combate</div>
            <div class="profile-battle-stats">
                <div class="battle-stat victories">
                    <span class="battle-stat-value" id="statVictorias">0</span>
                    <span class="battle-stat-label">Victorias</span>
                </div>
                <div class="battle-stat draws">
                    <span class="battle-stat-value" id="statEmpates">0</span>
                    <span class="battle-stat-label">Empates</span>
                </div>
                <div class="battle-stat defeats">
                    <span class="battle-stat-value" id="statDerrotas">0</span>
                    <span class="battle-stat-label">Derrotas</span>
                </div>
                <div class="battle-stat winrate">
                    <span class="battle-stat-value" id="statWinrate">0%</span>
                    <span class="battle-stat-label">% Victoria</span>
                </div>
            </div>

            <div class="profile-resources">
                <div class="resource-box gold">
                    <span class="resource-icon">üí∞</span>
                    <span class="resource-value" id="statMonedas">1000</span>
                    <span class="resource-name">Oro</span>
                </div>
                <div class="resource-box diamonds">
                    <span class="resource-icon">üíé</span>
                    <span class="resource-value" id="statDiamantes">50</span>
                    <span class="resource-name">Diamantes</span>
                </div>
            </div>

            <div class="profile-section-title">‚≠ê Nivel de Comandante</div>
            <div class="profile-level-section">
                <div class="level-info">
                    <span class="level-number">Nv. <span id="playerLevel">1</span></span>
                    <span class="level-xp"><span id="playerXP">0</span> / <span id="playerXPMax">100</span> XP</span>
                </div>
                <div class="xp-bar">
                    <div class="xp-fill" id="xpFill" style="width: 0%"></div>
                </div>
                <button class="btn-level-rewards" id="btnLevelRewards">üéÅ Ver Recompensas</button>
            </div>
        </div>
    </div>

    <!-- Contenedor principal del juego -->
    <div class="game-container">
        <!-- Header del juego -->
        <div class="game-header">
            <h1 class="game-logo">Strike Command</h1>
            <p class="game-subtitle">Dominio Total</p>
            
            <!-- Iconos de dominio (clickeables) -->
            <div class="domain-icons">
                <div class="domain-icon air" id="btnDominioAire" title="Dominio A√©reo">‚úàÔ∏è</div>
                <div class="domain-icon sea" id="btnDominioMar" title="Dominio Naval">üö¢</div>
                <div class="domain-icon land" id="btnDominioTierra" title="Dominio Terrestre">üéñÔ∏è</div>
            </div>
        </div>

        <!-- Zona de mensajes -->
        <div id="msg" class="mb-3"></div>
        
        <!-- Zona donde se cargan formularios de login/registro -->
        <div id="registro" class="mb-3"></div>
        
        <!-- √Årea principal de contenido -->
        <div id="au"></div>
    </div>
    <!-- The Modal -->
    <div class="modal" id="miModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">‚ö†Ô∏è Atenci√≥n</h4>
                    <button type="button" class="close text-white" data-dismiss="modal">&times;</button>
                </div>
                <!-- Modal body -->
                <div class="modal-body" id="mBody"></div>
                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>       
    <script>
        cw = new ControlWeb();
        rest = new ClienteRest(cw);
        ws = new ClienteWS();
        
        // Inicializaci√≥n de la interfaz: preguntar al servidor si hay sesi√≥n
        cw.comprobarSesion();

        // Toggle del dropdown del perfil
        $("#profileIconBtn").on("click", function(e) {
            e.stopPropagation();
            $("#profileDropdown").toggleClass("show");
            $("#rankingDropdown").removeClass("show");
        });

        // Toggle del panel de clasificaci√≥n
        $("#rankingToggleBtn").on("click", function(e) {
            e.stopPropagation();
            $("#rankingDropdown").toggleClass("show");
            $("#profileDropdown").removeClass("show");
        });

        // Cerrar dropdowns al hacer click fuera
        $(document).on("click", function(e) {
            if (!$(e.target).closest("#profileIcon").length) {
                $("#profileDropdown").removeClass("show");
            }
            if (!$(e.target).closest("#rankingPanel").length) {
                $("#rankingDropdown").removeClass("show");
            }
        });

        // Handler del bot√≥n ver recompensas por nivel
        $("#btnLevelRewards").on("click", function(e) {
            e.preventDefault();
            cw.mostrarRecompensasNivel();
        });

        // Handlers para los iconos de dominio
        $("#btnDominioAire").on("click", function() {
            if ($.cookie('nick')) {
                cw.mostrarMenuDominio('aire');
            }
        });

        $("#btnDominioMar").on("click", function() {
            if ($.cookie('nick')) {
                cw.mostrarMenuDominio('mar');
            }
        });

        $("#btnDominioTierra").on("click", function() {
            if ($.cookie('nick')) {
                cw.mostrarMenuDominio('tierra');
            }
        });
    </script>
</body>
</html>